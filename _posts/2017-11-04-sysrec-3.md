---
layout: post
title:  "Sistemas recomendadores, parte 3"
date:   2017-11-04 20:01:00 -0600
categories: sysrec spanish
published: true
---
<!-- entry 3, clase 25.10 -->

# Introducción

En la [parte 2]({{ site.baseurl }}{% post_url 2017-10-28-sysrec-2 %}) se vieron varios algunas formas de clasificar sistemas recomendadores (SR). El post cerró en el filtrado colaborativo en base a usuarios, y se mencionó el uso de KNN o *K Nearest Neighbors*, un método *basado en memoria*.

# SR basados en memoria [continuación]

## User Based Collaborative Filtering (UB-CF)
 En términos generales, se puede resumir que  

1.  La predicción del rating sobre un ítem $$i$$ mejora mientras más vecinos $$k$$ de un *pool* de $$n$$ elementos de dimensión $$d$$ se consideren en el cálculo de similitud.
1.  La complejidad de calcular la distancia a un ejemplo es de $$\mathcal{O}(d)$$
1.  La complejidad de calcular la distancia a $$n$$ ejemplos es de $$\mathcal{O}(dn)$$
1.  Una vez calculadas las $$n$$ distancias, la complejidad de recorrer los $$k$$ vecinos más cercanos es de $$\mathcal{O}(nk)$$
1.  El tiempo total entonces es de $$\mathcal{O}(nd+nk)$$, (o $$\mathcal{O}(ndk)$$ [en función de cómo se recorren los elementos.](https://stats.stackexchange.com/questions/219655/k-nn-computational-complexity)) lo cual vuelve a KNN un algoritmo costoso cuando $$n$$  es lo suficientemente grande. 

Un SR alternativo al *User Based* (UB-CF) es la del filtrado colaborativo basado en **ítems**, o *Item based collaborative filtering (IB-CF)*

## Item Based collaborative filtering (IB-CF)

Nacen de la necesidad de generar recomendaciones más rápidas sobre datasets masivos o más grandes, para los cuales los algoritmos basados en usuario no escalan bien. Estas técnicas analizan primero la matriz de usuarios e ítems $$M$$ para identificar relaciones entre diferentes ítems, y a través de éstas computar calcular de manera indirecta nuevas relaciones con los usuarios. 
Dicho de otra forma, estos algoritmos exploran las relaciones entre ítems similares, en vez de realizarla sobre usuarios similares. De esta manera las recomendaciones nuevas se logran encontrando ítems similares a otros que el usuario $$ u $$ ha calificado positivamente. Dado que las relaciones entre ítems es *relativamente* estática (a diferencia de los gustos de los usuarios, que son más dinámicos), estas recomendaciones tienden a ser más estables en el tiempo.

De la misma manera que en el caso de UB-CF, algunas métricas de similitud pueden ser la *correlación entre ítems*, o *similitud coseno*. [Este paper](http://files.grouplens.org/papers/www10_sarwar.pdf) Hace una revisión de los métodos indicados, y concluye que este tipo de SR poseen un rendimiento superior, además de proveer mejores recomendaciones que su compañero UB-CF. 

### Métricas de similitud

Resulta que la similitud o cómo se establece una noción de similitud es clave en el desarrollo de estos SR. Mencionamos en la parte anterior algo de esto, pero sin ahondar mucho.

#### Similitud coseno

Si se consideran dos vectores de dimensionalidad $$m$$, se define la similitud entre ambos a través del cálculo del *coseno* del ángulo entre ambos vectores. Formalmente, Si consideramos la matriz $$M$$ de $$m$$ usuarios y $$n$$ items, la similitud entre dos elementos está dada por

$$ sim(i,j) = \cos (\vec{i},\vec{j}) = \frac{\vec{i} \cdot \vec{j}}{ { \lVert \vec{i} \rVert }_{2} \ast { \lVert \vec{j} \rVert }_{2} } $$ 

#### Correlación de Pearson

Una métrica de similitud se obtiene a través de la correlación de Pearson, aislando los casos donde ocurra *co-validación* i.e. aquellos casos en que el usuario ha validado ítems $$i$$ y $$j$$ (ver imagen, obtenida del paper).

$$ sim(i,j) = \frac{ \sum_{u \in \mathcal{U}}(r_{u,i}-\bar{r}_{i})(r_{u,j}-\bar{r}_{j}) }{ \sqrt{\sum_{u \in \mathcal{U}}(r_{u,i}-\bar{r}_{i})^2} \sqrt{\sum_{u \in \mathcal{U}}(r_{u,i}-\bar{r}_{j})^2} } $$

Donde $$ r_{u,j} $$ es el rating del usuario $$ u $$ sobre el ítem $$ j $$ y $$ \bar{r}_{j} $$ es el *rating* promedio sobre el otro ítem. **Notar que a diferencia de la definición de UB-CF, $$ \bar{r}_{i} $$ se refiere al ítem, y no al usuario.**

{: style="text-align:center"}
![IB-CF]({{ "/assets/CF-IB_1.png" | absolute_url }} "IB-CF" )

Una diferencia fundamental en la definición de similitud para UB-CF versus IB-CF es el eje sobre el cual se realizan los cálculos, siendo las filas para el primer caso y las columnas para el segundo. La importancia de esto es que cada par en el conjunto a calcular corresponde a usuarios distintos. Esto tiene algunas desventajas, como la pérdida de escala entre usuarios i.e. no todos los usarios evalúan el mismo ítem de la misma manera, y este factor se diluye entre todos los usuarios. Una forma de resolver esto es ajustando *Similitud coseno*

#### Similitud coseno ajustada

Se obtiene incorporando el promedio $$\bar{r}_{u} $$ de votos de cada usuario en el cálculo de similitud, es decir

$$ sim(i,j) = \frac{ \sum_{u \in \mathcal{U}}(r_{u,i}-\bar{r}_{u})(r_{u,j}-\bar{r}_{u}) }{ \sqrt{\sum_{u \in \mathcal{U}}(r_{u,i}-\bar{r}_{u})^2} \sqrt{\sum_{u \in \mathcal{U}}(r_{u,i}-\bar{r}_{u})^2} } $$

De los tres métodos indicados, es esta noción de similitud la que obtiene mejores resultados

{: style="text-align:center"}
![IB-CF]({{ "/assets/similarities.png" | absolute_url }} "Similarities comparison" )

### Calculando predicciones

La etapa más relevante en estos sistemas de filtrado colaborativo es en la que se produce una predicción de un rating. Dicho de otra forma, nos interesa saber el valor $$ P_{u,i} $$ que un usuario $$ u $$ podría asignar a un ítem desconocido $$ i $$, en función del conocimiento previo de sus valoraciones sobre otros ítems.

El autor menciona dos formas de obtener este valor

1.  Suma ponderada
2.  Regresión sobre los ratings

Esto es todo por ahora. En el siguiente post veremos los sistemas basados en un modelo.


# A continuación
* *Model Based Recommender Systems* 




<!-- slide 16 -->
